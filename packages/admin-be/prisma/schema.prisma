generator client {
  provider = "prisma-client"
  output   = "generated/client"
}

datasource db {
  provider = "postgresql"
}

model User {
  id                    String        @id @default(uuid())
  email                 String        @unique
  name                  String
  aadhaarId             String
  consentDataCollection Boolean       @default(true)
  dateOfBirth           DateTime
  dateOfCreation        DateTime      @default(now())
  disability            String?       @default("None")
  lastUpdated           DateTime      @updatedAt
  password              String
  phoneNumber           String        @unique
  preferredLanguage     String        @default("English")
  status                userStatus    @default(ACTIVE)
  complaints            Complaint[]
  auditLogsCreated      AuditLog[]    @relation("LogCreator")
  upvotes               Upvote[]
  chats                 Chat[]
  location              UserLocation?
}

model UserLocation {
  id        String  @id @default(uuid())
  userId    String  @unique
  pin       String
  district  String
  city      String
  locality  String
  street    String?
  municipal String
  country   String  @default("India")
  state     String
  user      User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("user_locations")
}

model Agent {
  id                   String                    @id @default(uuid())
  email                String                    @unique
  fullName             String
  employeeId           String                    @unique @default(uuid())
  password             String
  phoneNumber          String
  officialEmail        String                    @unique
  department           Department
  municipality         String?
  accessLevel          AccessLevel               @default(AGENT)
  workloadLimit        Int                       @default(10)
  currentWorkload      Int                       @default(0)
  availabilityStatus   String                    @default("At Work")
  dateOfCreation       DateTime                  @default(now())
  lastUpdated          DateTime                  @updatedAt
  status               Status                    @default(ACTIVE)
  lastLogin            DateTime?
  resolutionRate       Float                     @default(0)
  avgResolutionTime    String?
  collaborationMetric  Int                       @default(0)
  managedByMunicipalId String?
  district             String?
  managedByMunicipal   DepartmentMunicipalAdmin? @relation("MunicipalAdminToAgents", fields: [managedByMunicipalId], references: [id])
  assignedComplaints   Complaint[]               @relation("AssignedAgentComplaints")
  coAssignedComplaints Complaint[]               @relation("CoAssignedAgentComplaints")
}

model DepartmentMunicipalAdmin {
  id                        String                @id @default(uuid())
  fullName                  String
  adminId                   String                @default(uuid())
  officialEmail             String                @unique
  phoneNumber               String
  password                  String
  department                Department
  municipality              String
  accessLevel               AccessLevel           @default(DEPT_MUNICIPAL_ADMIN)
  dateOfCreation            DateTime              @default(now())
  lastUpdated               DateTime              @updatedAt
  status                    Status                @default(ACTIVE)
  lastLogin                 DateTime?
  workloadLimit             Int                   @default(10)
  currentWorkload           Int                   @default(0)
  resolutionRate            Float                 @default(0)
  slaComplianceRate         Float?                @default(0)
  escalationCount           Int                   @default(0)
  managedByStateAdminId     String?
  managedBySuperMunicipalId String?
  managedAgents             Agent[]               @relation("MunicipalAdminToAgents")
  managedComplaints         Complaint[]           @relation("MunicipalAdminToComplaints")
  communityModeration       Complaint[]           @relation("MunicipalAdminModeratedComplaints")
  managedByStateAdmin       DepartmentStateAdmin? @relation("StateAdminToMunicipalAdmin", fields: [managedByStateAdminId], references: [id])
  managedBySuperMunicipal   SuperMunicipalAdmin?  @relation("SuperMunicipalToDepAdmin", fields: [managedBySuperMunicipalId], references: [id])
  newsUpdates               NewsUpdate[]

  @@map("department_municipal_admins")
}

model SuperMunicipalAdmin {
  id                         String                     @id @default(uuid())
  fullName                   String
  adminId                    String                     @default(uuid())
  officialEmail              String                     @unique
  password                   String
  phoneNumber                String?
  municipality               String
  accessLevel                AccessLevel                @default(SUPER_MUNICIPAL_ADMIN)
  dateOfCreation             DateTime                   @default(now())
  lastUpdated                DateTime                   @updatedAt
  status                     Status                     @default(ACTIVE)
  lastLogin                  DateTime?
  municipalityResolutionRate Float                      @default(0)
  crossDepartmentSuccess     Int                        @default(0)
  managedBySuperStateId      String?
  crossDepartmentIssues      Complaint[]                @relation("SuperMunicipalToCrossDeptIssues")
  managedDepartmentAdmins    DepartmentMunicipalAdmin[] @relation("SuperMunicipalToDepAdmin")
  managedBySuperState        SuperStateAdmin?           @relation("SuperStateToSuperMunicipal", fields: [managedBySuperStateId], references: [id])

  @@map("super_municipal_admins")
}

model DepartmentStateAdmin {
  id                     String                     @id @default(uuid())
  fullName               String
  adminId                String                     @default(uuid())
  officialEmail          String                     @unique
  password               String
  phoneNumber            String?
  department             Department
  state                  String
  accessLevel            AccessLevel                @default(DEPT_STATE_ADMIN)
  dateOfCreation         DateTime                   @default(now())
  lastUpdated            DateTime                   @updatedAt
  status                 Status                     @default(ACTIVE)
  lastLogin              DateTime?
  stateResolutionRate    Float                      @default(0)
  escalationCount        Int                        @default(0)
  managedMunicipalities  String[]                   @default([])
  managedBySuperStateId  String?
  managedCategories      Category[]
  escalatedComplaints    Complaint[]                @relation("StateAdminToEscalatedComplaints")
  managedMunicipalAdmins DepartmentMunicipalAdmin[] @relation("StateAdminToMunicipalAdmin")
  managedBySuperState    SuperStateAdmin?           @relation("SuperStateToStateAdmin", fields: [managedBySuperStateId], references: [id])
  regionalWorkflows      RegionalWorkflow[]

  @@map("department_state_admins")
}

model SuperStateAdmin {
  id                          String                 @id @default(uuid())
  fullName                    String
  adminId                     String                 @default(uuid())
  officialEmail               String                 @unique
  phoneNumber                 String?
  password                    String
  state                       String
  accessLevel                 AccessLevel            @default(SUPER_STATE_ADMIN)
  dateOfCreation              DateTime               @default(now())
  lastUpdated                 DateTime               @updatedAt
  status                      Status                 @default(ACTIVE)
  lastLogin                   DateTime?
  stateResolutionRate         Float                  @default(0)
  crossDepartmentSuccess      Int                    @default(0)
  managedBySuperAdminId       String?
  escalatedComplaints         Complaint[]            @relation("SuperStateToEscalatedComplaints")
  managedDepartmentAdmins     DepartmentStateAdmin[] @relation("SuperStateToStateAdmin")
  managedSuperMunicipalAdmins SuperMunicipalAdmin[]  @relation("SuperStateToSuperMunicipal")
  managedBySuperAdmin         SuperAdmin?            @relation("SuperAdminToSuperState", fields: [managedBySuperAdminId], references: [id])

  @@map("super_state_admins")
}

model SuperAdmin {
  id                      String            @id @default(uuid())
  fullName                String
  adminId                 String            @default(uuid())
  officialEmail           String            @unique
  phoneNumber             String?
  password                String
  accessLevel             AccessLevel       @default(SUPER_ADMIN)
  dateOfCreation          DateTime          @default(now())
  lastUpdated             DateTime          @updatedAt
  status                  Status            @default(ACTIVE)
  lastLogin               DateTime?
  managedCategories       Category[]
  managedComplaints       Complaint[]
  managedSuperStateAdmins SuperStateAdmin[] @relation("SuperAdminToSuperState")

  @@map("super_admins")
}

model Category {
  id                        String                @id @default(uuid())
  name                      String                @unique
  subCategories             String[]
  learnedSubCategories      String[]
  assignedDepartment        String
  creationDate              DateTime              @default(now())
  lastUpdated               DateTime              @updatedAt
  createdBySuperAdminId     String?
  managedByDeptStateAdminId String?
  createdBySuperAdmin       SuperAdmin?           @relation(fields: [createdBySuperAdminId], references: [id])
  managedByDeptStateAdmin   DepartmentStateAdmin? @relation(fields: [managedByDeptStateAdminId], references: [id])
  complaints                Complaint[]
}

model Complaint {
  id                             String                    @id @default(uuid())
  submissionDate                 DateTime                  @default(now())
  complainantId                  String?
  subCategory                    String
  description                    String
  urgency                        ComplaintUrgency          @default(LOW)
  attachmentUrl                  String?
  status                         ComplaintStatus           @default(REGISTERED)
  upvoteCount                    Int                       @default(0)
  isPublic                       Boolean
  assignedAgentId                String?
  assignedDepartment             String
  categoryId                     String
  crossDeptIssueSuperMunicipalId String?
  dateOfResolution               DateTime?
  escalatedToStateAdminId        String?
  escalatedToSuperStateAdminId   String?
  escalationLevel                String?
  managedByMunicipalAdminId      String?
  managedBySuperAdminId          String?
  moderatedByMunicipalAdminId    String?
  seq                            Int                       @unique @default(autoincrement())
  sla                            String?
  AIabusedFlag                   Boolean?
  AIimageVarificationStatus      Boolean?
  AIstandardizedSubCategory      String?
  lastUpdated                    DateTime                  @updatedAt
  isDuplicate                    Boolean?
  assignedAgent                  Agent?                    @relation("AssignedAgentComplaints", fields: [assignedAgentId], references: [id])
  category                       Category                  @relation(fields: [categoryId], references: [id])
  crossDeptIssueSuperMunicipal   SuperMunicipalAdmin?      @relation("SuperMunicipalToCrossDeptIssues", fields: [crossDeptIssueSuperMunicipalId], references: [id])
  escalatedToStateAdmin          DepartmentStateAdmin?     @relation("StateAdminToEscalatedComplaints", fields: [escalatedToStateAdminId], references: [id])
  escalatedToSuperStateAdmin     SuperStateAdmin?          @relation("SuperStateToEscalatedComplaints", fields: [escalatedToSuperStateAdminId], references: [id])
  User                           User?                     @relation(fields: [complainantId], references: [id])
  managedByMunicipalAdmin        DepartmentMunicipalAdmin? @relation("MunicipalAdminToComplaints", fields: [managedByMunicipalAdminId], references: [id])
  managedBySuperAdmin            SuperAdmin?               @relation(fields: [managedBySuperAdminId], references: [id])
  moderatedByMunicipalAdmin      DepartmentMunicipalAdmin? @relation("MunicipalAdminModeratedComplaints", fields: [moderatedByMunicipalAdminId], references: [id])
  auditLogs                      AuditLog[]
  location                       ComplaintLocation?
  upvotes                        Upvote[]
  coAssignedAgents               Agent[]                   @relation("CoAssignedAgentComplaints")
}

model ComplaintLocation {
  id          String    @id @default(uuid())
  complaintId String    @unique
  pin         String
  district    String
  city        String
  locality    String
  street      String?
  latitude    Float?
  longitude   Float?
  complaint   Complaint @relation(fields: [complaintId], references: [id], onDelete: Cascade)

  @@map("complaint_locations")
}

model Upvote {
  id          String    @id @default(uuid())
  userId      String
  complaintId String
  timestamp   DateTime  @default(now())
  complaint   Complaint @relation(fields: [complaintId], references: [id], onDelete: Cascade)
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, complaintId])
  @@map("upvotes")
}

model NewsUpdate {
  id          String                   @id @default(uuid())
  title       String
  content     String
  date        DateTime                 @default(now())
  createdById String
  createdBy   DepartmentMunicipalAdmin @relation(fields: [createdById], references: [id])

  @@map("news_updates")
}

model AuditLog {
  id          String     @id @default(uuid())
  action      String
  userId      String
  complaintId String?
  timestamp   DateTime   @default(now())
  details     String?
  complaint   Complaint? @relation(fields: [complaintId], references: [id])
  user        User       @relation("LogCreator", fields: [userId], references: [id])

  @@map("audit_logs")
}

model RegionalWorkflow {
  id           String               @id @default(uuid())
  municipality String?
  category     String
  sla          String
  createdById  String
  createdBy    DepartmentStateAdmin @relation(fields: [createdById], references: [id])

  @@map("regional_workflows")
}

model Chat {
  id        String    @id @default(uuid())
  message   String
  userId    String
  adminId   String?
  adminRole AdminRole?
  imageUrl  String?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("chats")
  @@index([userId])
  @@index([adminId])
}

model operating_states {
  id                  String                @id
  name                String
  country             String                @default("India")
  operating_districts operating_districts[]
}

model operating_districts {
  id               String           @id
  stateId          String
  name             String
  state            String
  operating_states operating_states @relation(fields: [stateId], references: [id], onDelete: Cascade)
}

enum userStatus {
  ACTIVE
  DELETED
  SUSPENDED
}

enum AdminRole {
  SUPER_ADMIN
  SUPER_STATE_ADMIN
  DEPT_STATE_ADMIN
  SUPER_MUNICIPAL_ADMIN
  DEPT_MUNICIPAL_ADMIN
  AGENT
}

enum Status {
  ACTIVE
  INACTIVE
  SUSPENDED
}

enum AccessLevel {
  SUPER_ADMIN
  SUPER_MUNICIPAL_ADMIN
  SUPER_STATE_ADMIN
  DEPT_MUNICIPAL_ADMIN
  DEPT_STATE_ADMIN
  AGENT
}

enum Department {
  INFRASTRUCTURE
  EDUCATION
  REVENUE
  HEALTH
  WATER_SUPPLY_SANITATION
  ELECTRICITY_POWER
  TRANSPORTATION
  MUNICIPAL_SERVICES
  POLICE_SERVICES
  ENVIRONMENT
  HOUSING_URBAN_DEVELOPMENT
  SOCIAL_WELFARE
  PUBLIC_GRIEVANCES
}

enum ComplaintStatus {
  REGISTERED
  UNDER_PROCESSING
  FORWARDED
  ON_HOLD
  COMPLETED
  REJECTED
  ESCALATED_TO_MUNICIPAL_LEVEL
  ESCALATED_TO_STATE_LEVEL
  DELETED
}

enum ComplaintUrgency {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}
